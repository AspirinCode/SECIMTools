<tool id="RTflag" name="RT flags">
  <description>Calculate RT flags</description>
  <requirements>
    <requirement type="python-module">numpy</requirement>
    <requirement type="python-module">pandas</requirement>
    <requirement type="python-module">matplotlib</requirement>
    <requirement type="python-module">scipy</requirement>
  </requirements>
  <command interpreter="python">RTflag.py
      --input $input
      --design $design
      --ID $uniqID
      --RTplotOutFile $RTplot
      --RTflagOutFile $RTflag

      #if $CVcutoff:
	    --CVcutoff $CVcutoff
      #end if
      #if $pctl
        --pctl
      #end if
  </command>
  <inputs>
    <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input dataset in wide format and tab separated. If not tab separated see TIP below."/>
    <param name="design" type="data" format="tabular" label="Metadata File" help="Metadata file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
    <param name="uniqID" type="text" size="30" value="" label="Unique Compound ID" help="Name of the column in your Wide Dataset that has unique compound/gene IDs."/>
    <param name="CVcutoff" optional="true" type="float" value=".1" size="4" label="CVcutoff [OPTIONAL]" help="The default CV cutoff will flag 10 percent of the rowIDs with larger CVs. If you want to set a CV cutoff, put the number here."/>
    <param name="pctl" type="boolean" size="30" label="90th percentile [OPTIONAL]" help="Check this box to use a 90th percentile. The default is a 95th percentile. [OPTIONAL]" />
  </inputs>
  <outputs>
    <data format="png" name="RTplot"  label="RTplot" />
    <data format="tabular" name="RTflag"  label="RTflag" />
  </outputs>
<help>

..class:: infomark

**TIP:**
If your data is not TAB delimited, use *Text Manipulation-&gt;Convert*

.. class:: warningmark

**WARNINGS: (1) This script automatically removes spaces and special characters from strings.  (2) If a compound name starts with a number it will prepend an '_'.

--------------------------------------------------------------------------------

**What it does**

This tool identifies features with the following characteristics:
    (1) features whose coefficient of variation in retention time is greater than 90% (default value) of all features and
    (2) features where the difference in the retention time between the 90th and 10th percentiles (default values) is greater than 0.2 seconds.
    (3) features where the difference between the retention time maximum and median is greater than 0.1 seconds.
    (4) features where the difference between the retention time minimum and median is greater than 0.1 seconds.
    (5) features where the retention time minimum or maximum is greater than 3 times the standard deviation away from the mean.

--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

**Wide Formatted Dataset:**

A wide formatted dataset that contains measurements for each sample.::

    +----------+---------+---------+---------+-----+
    | Compound | sample1 | sample2 | sample3 | ... |
    +==========+=========+=========+=========+=====+
    | one      | 10      | 20      | 10      | ... |
    | two      | 5       | 22      | 30      | ... |
    | three    | 30      | 27      | 2       | ... |
    | four     | 32      | 17      | 8       | ... |
    | ...      | ...     | ...     | ...     | ... |
    +----------+---------+---------+---------+-----+

    **NOTE:** The sample IDs must match the sample IDs in the Design File (below).
    Extra columns will automatically be ignored.


**Metadata File:**
A metatdata file relating samples to various groups/treatment.::

    +----------+--------+
    | sampleID | group1 |
    +==========+========+
    | sample1  | g1     |
    | sample2  | g1     |
    | sample3  | g1     |
    | sample4  | g2     |
    | sample5  | g2     |
    | sample6  | g2     |
    | ...      | ...    |
    +----------+--------+

    **NOTE: You must have a column named *sampleID***
    and the values in this column must match the columns names in the wide
    formatted dataset. Extra columns will be ignored.

**In addition to your datasets, you need to provide:**

**Unique Compound ID**

    - The column name in your wide dataset that contains the unique IDs for
      your compounds. In our example dataset you would input *Compound*.

**Cvcutoff**  [Optional]

    - The column name in your design file that contains group information. In
      our example design file we would put *group1*.

**90th percentile**  [Optional]

- The default is to flag features when the difference in the retention time between the 90th and 10th percentiles is greater
  than 0.2 seconds. The user has the option to select the 95th and 5th percentiles instead.

--------------------------------------------------------------------------------

**Output Files**

- The tool generates 2 output datasets.

    **CvplotForRT** is a PNG density plot of the coefficients of variation for the retention time.

    **RTflag** is a TSV file containing the 5 retention time 0/1 indicator flags for each feature.

</help>
</tool>
