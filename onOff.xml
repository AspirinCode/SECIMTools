<tool id="onOff2" name="On/Off Flags (Beta)" version="2.0.0">
    <description>Flags metabolite features as on or off.</description>
    <requirements>
        <requirement type="python-module">numpy</requirement>
        <requirement type="python-module">pandas</requirement>
    </requirements>
    <command interpreter="python">onOff.py
        --input $input
        --design $design
        --ID $uniqID
        --output $output
        --group $group

    #if $cutoff:
        --cutoff $cutoff
    #end if
    </command>
    <inputs>
        <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input dataset in wide format and tab separated. If file is not tab separated see TIP below."/>
        <param name="design" type="data" format="tabular" label="Design File" help="Design file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below."/>
        <param name="uniqID" type="text" size="30" value="" label="Unique Feature ID" help="Name of the column in your Wide Dataset that has unique Feature IDs."/>
        <param name="group" type="text" size="30" label="Group/Treatment" help="Insert the group name from the Design file to separate the flag file" />
        <param name="cutoff" type="integer" optional="true" size="4" value="30000" label="Cutoff" help="Cutoff to use for which values to flag. This defaults to 30,000"/>
    </inputs>
    <outputs>
        <data format="tabular" name="output" label="${tool.name} on ${on_string}" />
    </outputs>
    <macros>
        <import>macros.xml</import>
    </macros>
<help>

@TIP_AND_WARNING@

**Tool Description**

This tool generates a flag for each feature if, in any of the indicated treatment goups,
half of the data is below a user-input cutoff value or missing.  Default value is 30,000.

--------------------------------------------------------------------------------


**Input**

- Two input datasets are required.

    @WIDE@

    **NOTE:** The sample IDs must match the sample IDs in the Design File (below).
    Extra columns will automatically be ignored.


    @METADATA@

    **In addition to your datasets, you need to provide:**

    **Unique Feature ID**

    - The column name in your wide dataset that contains the unique IDs for
      your featuress. In our example dataset you would input *Feature*.


    **In addition to your datasets, you need to provide:**

    **Input group name from Design file**

    - The column name in your Design file that contains the group/treatment information.  In the above example, you would input *group*.


- In addition to your datasets, you can specify a different cutoff:

    **Cutoff**

    - A cutoff below which values are under the level of detection.  Default value
      is 30,000.

--------------------------------------------------------------------------------

**Output**

    :Flags are generated for each feature:

    ::

        - For each group, if 50% or more of the values within a group are less than the indicated cutoff value then flag_group_off = 1.
        - If at least 1 of the groups is flagged then flag_met_off = 1.
        - If all groups are flagged then flag_met_all_off = 1.

    +-----------+-----------------+------------------+--------------+------------------+
    | Feature   | flag_group1_off | flag_group2_off  | flag_met_off | flag_met_all_off |
    +===========+=================+==================+==============+==================+
    | one       | 0               | 0                | 0            | 0                |
    +-----------+-----------------+------------------+--------------+------------------+
    | two       | 1               | 1                | 1            | 1                |
    +-----------+-----------------+------------------+--------------+------------------+
    | three     | 1               | 0                | 1            | 0                |
    +-----------+-----------------+------------------+--------------+------------------+

</help>
</tool>
