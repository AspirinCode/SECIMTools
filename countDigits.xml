<tool id="countDigits" name="Count Digits">
  <description>Count the number of digits before the period.</description>
  <requirements>
    <requirement type="python-module">numpy</requirement>
    <requirement type="python-module">pandas</requirement>
    <requirement type="python-module">matplotlib</requirement>
  </requirements>
  <command interpreter="python">
      countDigits.py
      --html $html
      --html_path "$html.files_path"
      --input $input
      --design $design
      --ID $uniqID
      --flags $flags

      #if $nozero:
          --noZero
      #end if
      #if $group:
	    --group $group
      #end if
  </command>
  <inputs>
    <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input dataset in wide format and tab separated. If not tab separated see TIP below."/>
    <param name="design" type="data" format="tabular" label="Metadata File" help="Metadata file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
    <param name="uniqID" type="text" size="30" value="" label="Unique Compound ID" help="Name of the column in your Wide Dataset that has unique compound/gene IDs."/>
    <param name="nozero" type="select" size="30" display="radio" value="yes" label="Remove zeros before processing" help="If you do not remove zeros before processing, otherwise a zero will skew results.">
        <option value="yes">Remove zeros</option>
        <option value="no">Do not remove zeros</option>
    </param>
    <param name="group" size="30" type="text" label="Input Group name to separate by [OPTIONAL]" help="If you wish to sort by groups in a column in the Metadata file, enter the column name. Spelling and capitalization must be exact" />
  </inputs>
  <outputs>
    <data format="html" name="html"  label="CountDigits_Output_List.html" />
    <data format="tabular" name="flags" label="CountDigits_Flags" />
  </outputs>
<help>

.. class:: infomark

**TIP:**
If your data is not TAB delimited, use *Text Manipulation-&gt;Convert*

.. class:: warningmark

**WARNINGS:**
    - (1) A row will be dropped when a pairwise comparison has a missing value.
    - (2) This script automatically removes spaces and special characters from strings.
    - (3) If a compound name starts with a number it will prepend an '_'.

--------------------------------------------------------------------------------

**What it does**

This tool counts the number of digits before the decimal place for each value. Used to identify values with different orders of magnitude across an individual feature.  Unusual samples may be identified by finding systematically low or high feature values for a particular sample. 


--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

      **Wide Formatted Dataset:**

    A wide formatted dataset that contains measurements for each sample.::

        +----------+---------+---------+---------+-----+
        | Compound | sample1 | sample2 | sample3 | ... |
        +==========+=========+=========+=========+=====+
        | one      | 10      | 20      | 10      | ... |
        | two      | 5       | 22      | 30      | ... |
        | three    | 30      | 27      | 2       | ... |
        | four     | 32      | 17      | 8       | ... |
        | ...      | ...     | ...     | ...     | ... |
        +----------+---------+---------+---------+-----+

    **NOTE:** The sample IDs must match the sample IDs in the Design File (below).
    Extra columns will automatically be ignored.


    **Metadata File:**
    A Metadata file relating samples to various groups/treatment.::

        +----------+--------+
        | sampleID | group1 |
        +==========+========+
        | sample1  | g1     |
        | sample2  | g1     |
        | sample3  | g1     |
        | sample4  | g2     |
        | sample5  | g2     |
        | sample6  | g2     |
        | ...      | ...    |
        +----------+--------+

    **NOTE: You must have a column named *sampleID***
    and the values in this column must match the columns names in the wide
    formatted dataset. Extra columns will be ignored.

    **In addition to your datasets, you need to provide:**

    **Unique Compound ID**

    - The column name in your wide dataset that contains the unique IDs for
      your compounds. In our example dataset you would input *Compound*


    **Group/Treatment** [Optional]

    - The column name in your design file that contains group information. In
      our example design file we would put *group1*. If provided samples will
      be colored by group.

--------------------------------------------------------------------------------

**Output Files**

- This tool outputs an html page containing links to the files created.  Separating by group is recommended, where applicable.

    **Counts_table** is a TSV file with feature as row and sample as column. Values
    are the number of digits for a given feature-sample combination. The maximum,
    minimum and differences are calculated for each feature.  If groups are given,
    each groups generates a separate counts_table

    **Figure.png** is a plot of the differences between the maximum and minimum, by
    group if specified.

    **Flags** is a TSV file with feature as row and containing a summary 0/1
    indicator flag.  A feature is given a '1' if the difference for that feature
    across all groups, if specified, is greater than or equal to 2.


</help>
</tool>

