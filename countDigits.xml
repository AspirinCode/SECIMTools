<tool id="countDigits" name="Count Digits">
  <description>Count the number of digits before the period.</description>
  <requirements>
    <requirement type="python-module">numpy</requirement>
    <requirement type="python-module">pandas</requirement>
    <requirement type="python-module">matplotlib</requirement>
  </requirements>
  <command interpreter="python">
      countDigits.py
      --html $html
      --html_path "$html.files_path"
      --input $input
      --design $design
      --ID $uniqID
      --flags $flags

      #if $nozero:
          --noZero
      #end if
      #if $group:
	    --group $group
      #end if
  </command>
  <inputs>
    <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input dataset in wide format and tab separated. If file is not tab separated see TIP below."/>
    <param name="design" type="data" format="tabular" label="Metadata File" help="Metadata file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
    <param name="uniqID" type="text" size="30" value="" label="Unique Feature ID" help="Name of the column in your Wide Dataset that has unique feature/compound/gene IDs."/>
    <param name="nozero" type="select" size="30" display="radio" value="yes" label="Remove zeros before processing" help="If you do not remove zeros before processing, otherwise a zero will skew results.">
        <option value="yes">Remove zeros</option>
        <option value="no">Do not remove zeros</option>
    </param>
    <param name="group" size="30" type="text" label="Input Group name to separate by [OPTIONAL]" help="If you wish to sort by groups in a column in the Metadata file, enter the column name. Spelling and capitalization must be exact" />
  </inputs>
  <outputs>
    <data format="html" name="html"  label="CountDigits_Output_List.html" />
    <data format="tabular" name="flags" label="CountDigits_Flags" />
  </outputs>
  <macros>
      <import>macros.xml</import>
  </macros>
    <tests>
        <test>
            <param name="input" value="./test-data/test_data.tsv" />
            <param name="design" value="./test-data/test_design.csv" />
            <param name="uniqID" value="rowID" />
            <param name="group" value="treatment" />
            <!--<param name="html_path" value="./test-data/html-path/" />-->
            <output name="html" file="./test-data/html-path/html.html" />
            <output name="flags" file="./test-data/html-path/flags.tsv" />
        </test>
    </tests>
<help>

@TIP_AND_WARNING@

**What it does**

This tool counts the number of digits before the decimal place for each value.
Used to identify values with different orders of magnitude across an individual
feature. Unusual samples may be identified by finding systematically low or
high feature values for a particular sample.

--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

    @WIDE@

    **NOTE:** The sample IDs must match the sample IDs in the Metadata File
    (below). Extra columns will automatically be ignored.


    @METADATA@

    **In addition to your datasets, you need to provide:**

    **Unique Feature ID**

    - The column name in your wide dataset that contains the unique IDs for
      your features. In our example dataset you would input *Feature*


      @GROUP_OPTIONAL@

--------------------------------------------------------------------------------

**Output Files**

- This tool outputs an html page containing links to the files created.
  Separating by group is recommended, where applicable.

    **Counts_table** is a TSV file with features as rows and samples as
    columns. Values are the number of digits, before a decimal, for a given feature-sample
    combination. The maximum, minimum and difference are calculated for each
    feature. If groups are given, each groups generates a separate counts_table

    **Figure.png** is a plot of the differences between the maximum and minimum, by
    group if specified.

    **Flags** is a TSV file with features as rows with a summary 0|1 indicator
    flag. A feature is given a '1' if the difference for that feature across
    all groups, if specified, is greater than or equal to 2.


</help>
</tool>

