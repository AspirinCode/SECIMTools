<tool id="runOrder" name="Run Order Regression">
  <description>Look for linear relationships with run order.</description>
  <requirements>
    <requirement type="python-module">numpy</requirement>
    <requirement type="python-module">scipy</requirement>
    <requirement type="python-module">pandas</requirement>
    <requirement type="python-module">statsmodels</requirement>
    <requirement type="python-module">matplotlib</requirement>
  </requirements>
  <command interpreter="python">runOrderRegression.py
      --input $input
      --design $design
      --ID $uniqID
      --group $group
      --order $order
      --fig $order_plots
      --table $order_summary
  </command>
  <inputs>
    <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input dataset in wide format and tab separated. If file is not tab separated see TIP below."/>
    <param name="design" type="data" format="tabular" label="Metadata File" help="Metadata file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
    <param name="uniqID" type="text" size="30" value="" label="Unique Feature ID" help="Name of the column in your Wide Dataset that has unique feature/compound/gene IDs."/>
    <param name="group" type="text" size="30" value="" label="Group/Treatment" help="Name of the column in your Metadata File that contains group classifications."/>
    <param name="order" type="text" size="30" value="" label="Run Order ID" help="Name of the column in your Metadata File that contains run order."/>
  </inputs>
  <stdio>
    <regex match="FutureWarning" source="both" level="log" description="Python FutureWarning from secimtools runOrderRegression"/>
  </stdio>
  <outputs>
    <data format="pdf" name="order_plots" />
    <data format="tabular" name="order_summary"/>
  </outputs>
  <macros>
      <import>macros.xml</import>
  </macros>
  <tests>
      <test>
          <param name="input" value="./test-data/test_data.tsv" />
          <param name="design" value="./test-data/test_design.csv" />
          <param name="uniqID" value="rowID" />
          <param name="group" value="treatment" />
          <param name="order" value="runOrder" />
          <output name="order_plots" file="./test-data/test_runOrderRegression_fig.pdf" />
          <output name="order_summary" file="./test-data/test_runOrderRegression_table.pdf" />
      </test>
  </tests>
<help>

@TIP_AND_WARNING@

**What it does**

This tool uses linear regression to identify potential relationships between the order samples were run in and their values.  If a linear relationship with run order is identified, further exploration may be warranted.   

--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

    @WIDE@

    **NOTE:** The sample IDs must match the sample IDs in the Design File (below).
    Extra columns will automatically be ignored.


    @METADATA@

**In addition to your datasets, you need to provide:**

    **Unique Feature ID**

        - The column name in your wide dataset that contains the unique IDs for
          your features. In our example dataset you would input *Feature*.

    @GROUP@

    **Run Order ID**

        - The column name in your Metadata file that contains the order samples were
          run.

-----------------------------------------------------------------------------------

**Output Files**

- This tool outputs 2 different files:

    **runOrder_PDF** is a PDF containing the regression plots, one plot for each
    feature, where the x-axis is run order and the y-axis is value.  Only plots
    where the p- value was less than 0.05 are output as PDFs given that the
    prediction is no linear association of run order with value (i.e., slope = 0).
    Features with a significant p-value are candidates for further investigation.

    .. image:: ${static_path}/images/secim/runOrder_plot.png
        :height: 300
        :width: 600

    The regression for Tyrosine is shown above. The values for each sample is
    plotted as a blue data point. They cyan colored line is the regression line
    with a slope of 0.193 and an R^2 0.165. Red lines indicate the confidence
    interval around the slope of the regression line.


    **runOrder_TSV** is a TSV file containing the regression summary information
    (slope, p-value and rSquared) in addtion to a 0/1 indicator flag for a
    signficant regression at a nominal p-value of (i) 0.05 and (ii) 0.10.


</help>
</tool>
