<tool id="CVflag" name="CV flags">
  <description>Calculate CV flags</description>
  <requirements>
    <requirement type="python-module">numpy</requirement>
    <requirement type="python-module">pandas</requirement>
    <requirement type="python-module">matplotlib</requirement>
  </requirements>
  <command interpreter="python">CVflag.py
      --input $input
      --design $design
      --ID $uniqID
      --CVplotOutFile $CVplot
      --CVflagOutFile $CVflag

      #if $group:
          --group $group
      #end if
      #if $CVcutoff:
	    --CVcutoff $CVcutoff
      #end if
  </command>
  <inputs>
    <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input dataset in wide format and tab separated. If not tab separated see TIP below."/>
    <param name="design" type="data" format="tabular" label="Metadata File" help="Metadata file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
    <param name="uniqID" type="text" size="30" value="" label="Unique Compound ID" help="Name of the column in your Wide Dataset that has unique compound/gene IDs."/>
    <param name="CVcutoff"  type="float" optional="true" size="4" label="CVcutoff [OPTIONAL]" help="The default CV cutoff will flag 10 percent of the rowIDs with larger CVs. If you want to set a CV cutoff, put the number here."/>
    <param name="group" type="text" size="30" label="Input Group name to separate by [OPTIONAL]" help="If you wish to sort by groups in a column in the Metadata file, enter the column name. Spelling and capitalization must be exact" />
  </inputs>
  <outputs>
    <data format="pdf" name="CVplot"  label="CVplot" />
    <data format="tabular" name="CVflag"  label="CVflag" />
  </outputs>
    <!--<tests>-->
        <!--<test>-->
            <!--<param name="input" value="ST000015_log.tsv" />-->
            <!--<param name="design" value="ST000015_design.tsv" />-->
            <!--<param name="uniqID" value="Name" />-->
            <!--<output name="CVplotOutFile" file="CVflag-CVplotOutFile-test.pdf" />-->
            <!--<output name="CVflagOutFile" file="CVflag-CVflagOutFile-test.tsv" />-->
        <!--</test>-->
    <!--</tests>-->
    <!--<macros>-->
        <!--<import>help_section_macro.xml</import>-->
    <!--</macros>-->
<help>

.. class:: infomark

**TIP:** If your data is not TAB delimited, use *Text Manipulation-&gt;Convert*

.. class:: warningmark

**WARNINGS:**

    - (1) A row will be dropped when a pairwise comparison has a missing value.
    - (2) This script automatically removes spaces and special characters from strings.
    - (3) If a compound name starts with a number it will prepend an '_'.

--------------------------------------------------------------------------------

**What it does**

This tool calculates the coefficient of variation. Can be used to identify
features with larger than expected variability. Recommend using log transformed
data.

--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

    **Wide Formatted Dataset**

    A wide formatted dataset that contains measurements for each sample.::

        +----------+---------+---------+---------+-----+
        | Compound | sample1 | sample2 | sample3 | ... |
        +==========+=========+=========+=========+=====+
        | one      | 10      | 20      | 10      | ... |
        | two      | 5       | 22      | 30      | ... |
        | three    | 30      | 27      | 2       | ... |
        | four     | 32      | 17      | 8       | ... |
        | ...      | ...     | ...     | ...     | ... |
        +----------+---------+---------+---------+-----+

    **NOTE:** The sample IDs must match the sample IDs in the Metadata File (below).
    Extra columns will automatically be ignored.

    **Metadata File:** A Metadata file relating samples to various
    groups/treatment.::

        +----------+--------+
        | sampleID | group1 |
        +==========+========+
        | sample1  | g1     |
        | sample2  | g1     |
        | sample3  | g1     |
        | sample4  | g2     |
        | sample5  | g2     |
        | sample6  | g2     |
        | ...      | ...    |
        +----------+--------+

    **NOTE: You must have a column named *sampleID*** and the values in this
    column must match the column names in the wide dataset.


    **In addition to your datasets, you need to provide:**

    **Unique Compound ID**

    - The column name in your wide dataset that contains the unique IDs for
      your compounds. In our example dataset you would input *Compound*

    **Cvcutoff**   [Optional]

    - Here you can opt to change the default CV cutoff used to generate the 0|1
      indicator flags. The default CV cutoff (10 %) will flag features with a CV
      larger than 90 % of the features.

    **Group/Treatment** [Optional]

    - The column name in your metadata file that contains group information. In
      our example metadata file we would put *group1*. If provided samples will
      be colored by group.

--------------------------------------------------------------------------------

**Output Files**

- This tool outputs a CV density plot and a text filed containing flags for
  features with a large CV.

    **CVplot_PDF** is a PDF of a CV density plot. If group information is
    given, one plot is produced for each group in addition to a combined density
    plot containing all groups.

    **CVflag_table** is a TSV file with feature as row and containing a summary
    0|1 indicator flag for whether the CV for a given feature is greater than
    the threshold value. A feature is given a '1' if the CV for that feature
    is greater than the threshold given.  If group is specified, additional
    group-specific 0|1 indicator flags will be present.

</help>

</tool>
