<tool id="CVflag2" name="CV flags (Beta)" version="2.0.0">
  <description>Calculate CV flags</description>
  <requirements>
    <requirement type="python-module">numpy</requirement>
    <requirement type="python-module">pandas</requirement>
    <requirement type="python-module">matplotlib</requirement>
    <requirement type="python-module">palettable</requirement>
  </requirements>
  <command interpreter="python">CVflag.py
      --input $input
      --design $design
      --ID $uniqID
      --figure $CVplot
      --flag $CVflag

      #if $group:
          --group $group
      #end if
      #if $CVcutoff:
	    --CVcutoff $CVcutoff
      #end if
  </command>
  <inputs>
    <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input dataset in wide format and tab separated. If file is not tab separated see TIP below."/>
    <param name="design" type="data" format="tabular" label="Design File" help="Design file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
    <param name="uniqID" type="text" size="30" value="" label="Unique Feature ID" help="Name of the column in your Wide Dataset that has unique Feature IDs."/>
    <param name="group" type="text" size="30" label="Group/Treatment [Optional]" help="If you wish to sort by a column in the Design file, enter the column name. Spelling and capitalization must be exact" />
    <param name="CVcutoff"  type="float" optional="true" size="4" label="CV cutoff [Optional]" help="The default CV cutoff will flag the top 10% of features with the largest CV. If you want to set a CV cutoff, put the number here."/>
  </inputs>
  <outputs>
    <data format="pdf" name="CVplot"  label="${tool.name} on ${on_string}: Plot" />
    <data format="tabular" name="CVflag"  label="${tool.name} on ${on_string}: Flag" />
  </outputs>
  <macros>
      <import>macros.xml</import>
  </macros>
<help>

@TIP_AND_WARNING@


**What it does**

This tool calculates the coefficient of variation. Can be used to identify and flag
features with larger than expected variability. Recommend using log transformed
data.

--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

    @WIDE@

    **NOTE:** The sample IDs must match the sample IDs in the Design File (below).
    Extra columns will automatically be ignored.

    @METADATA@

    **In addition to your datasets, you need to provide:**

    **Unique Feature ID**

    - The column name in your wide dataset that contains the unique IDs for
      your featuress. In our example dataset you would input *Feature*

    **Cvcutoff**   [Optional]

    - Here you can opt to change the default CV cutoff used to generate the 0/1
      indicator flags. The default CV cutoff (10 %) will flag features with a CV
      larger than 90 % of the features.

    @GROUP_OPTIONAL@


--------------------------------------------------------------------------------

**Output Files**

    - A PDF of a CV density plot. If group information is given, one plot is produced for each group in addition to a combined density plot containing all groups.

    - A TSV with feature as row and containing a summary 0|1 indicator flag for whether the CV for a given feature is greater than the threshold value. A feature is given a '1' if the CV for that feature is greater than the threshold given.  If group is specified, additional group-specific 0|1 indicator flags will be present.

</help>

</tool>
