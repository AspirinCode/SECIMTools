<tool id="imputation2" name="Imputation" version="0.0.5">
    <description>Fills missing data by selected imputation algorithm.</description>
    <requirements>
        <requirement type="python-module">rpy2</requirement>
        <requirement type="python-module">pandas</requirement>
        <requirement type="python-module">numpy</requirement>
        <requirement type="python-module">sklearn</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" level="warning" description="UserWarning"/>
        <exit_code range="1:" level="warning" description="VisibleDeprecationWarning"/>
    </stdio>
    <command interpreter="python">
        imputation.py
        --input $input
        --design $design
        --ID $uniqID
        --group $group

        --output $imputed

        --knn $k
        --strategy $imputation
        --row_cutoff $rowCutoff
        --col_cutoff $colCutoff
        --distribution $distribution

        #if $noZero
            --no_zero
        #end if

        #if $noNeg
            --no_negative
        #end if

        #if $exclude
            --exclude $exclude
        #end if
    </command>
    <inputs>
        <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input dataset in wide format and tab separated. If file is not tab separated see TIP below."/>
        <param name="design" type="data" format="tabular" label="Design File" help="Design file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below."/>
        <param name="uniqID" type="text" size="30" value="" label="Unique Feature ID" help="Name of the column in your Wide Dataset that has unique Feature IDs."/>
        <param name="group" type="text" size="30" label="Input Group name to separate by" help="Enter group name to calculate from. Spelling and capitalization must be exact."/>

        <param name="imputation" size="30" type="select" value="" label="Imputation Strategy" help="Recommended: KNN">
            <option value="knn" selected="true">K-Nearest Neighbors</option>
            <option value="bayesian" selected="true">Bayesian</option>
            <option value="mean" selected="true">Mean</option>
            <option value="median" selected="true">Median</option>
        </param>
        <param name="noZero" type="boolean" label="Count Zeroes as missing" help="Zeroes can be counted as missing or left as data."/>
        <param name="noNeg" type="boolean" label="Count Negative as missing" help="Negatives can be counted as missing or left as data."/>
        <param name="exclude" type="text" size="30" value="" label="Additional values to treat missing [Optional]" help="Seperate additional values to count as missing data with commas."/>
        <param name="rowCutoff" type="text" size="30" value=".5" label="Row Percent Cutoff Value" help="Proportion of missing values allowed per group per row. If the proportion of missing samples in the row is bigger than the cutoff value specified nonthing will be imputed for that row. Default: .5 (50%)."/>
        <param name="k" type="text" size="30" value="5" label="K value" help="If you are not using the KNN Imputation, then ignore this. K is the number of neighbors to search. Default: 5. If less then 5 neighbours are available all of them are used."/>
        <param name="colCutoff" type="text" size="30" value=".8" label="Column Percent Cutoff Value" help="If you are not using the KNN Imputation, then ignore this. The maximum proportion of  missing data allowed in any data column. Default: .8 (80%). The imputation will not be successful is the proportion in the data exceeds this cutoff!"/>
        <param name="distribution" size="30" type="select" value="" label="Bayesian Distribution" help="Recommended: Poisson.">
            <option value="Poisson" selected="true">Poisson</option>
            <option value="Normal" selected="true">Normal</option>
        </param>
    </inputs>
    <outputs>
        <data format="tabular" name="imputed" label="${tool.name} on ${on_string}"/>
    </outputs>
    <macros>
        <import>macros.xml</import>
    </macros>
<help>

@TIP_AND_WARNING@

.. class:: infomark

**Tool Description**

This tool imputes missing data in a dataset.

--------------------------------------------------------------------------------

.. class:: warningmark

**Note**

- This tool currently treats all variables as continuous numeric
  variables. Running the tool on categorical variables might result in
  incorrect results. 
- Rows containing non-numeric (or missing) data in any
  of the chosen columns will be skipped from the analysis.

--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

    @WIDE@

    **NOTE:** The sample IDs must match the sample IDs in the Design File (below).
    Extra columns will automatically be ignored.


    @METADATA@

**In addition to your datasets, you need to provide:**

**Unique Feature ID**

- The column name in your wide dataset that contains the unique IDs for
  your features. In our example dataset you would input *Feature*.

--------------------------------------------------------------------------------

**Output**

- A wide format TSV with missing values filled in.


</help>
</tool>
