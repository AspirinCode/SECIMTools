<tool id="imputation2" name="Imputation" version="0.0.5">
    <description>"Attempts to fill missing data by selected imputation algorithm"</description>
    <requirements>
        <requirement type="python-module">rpy2</requirement>
        <requirement type="python-module">pandas</requirement>
        <requirement type="python-module">numpy</requirement>
        <requirement type="python-module">sklearn</requirement>

    </requirements>
    <command interpreter="python">
        imputation.py
        --input $input
        --design $design
        --ID $uniqID
        --group $group
        --output $imputed
        --knn $k
        --strategy $strategy
        --row_cutoff $rowCutoff
        --col_cutoff $colCutoff
        --bayes_cutoff $bayesCutoff
        --mu_method $muMethod
        --distribution $distribution
        #if $noZero
            --no_zero
        #end if

        #if $noNeg
            --no_negative
        #end if

        #if $exclude
            --exclude $exclude
        #end if
    </command>
    <inputs>
        <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input dataset in wide format and tab separated. If file is not tab separated see TIP below."/>
        <param name="design" type="data" format="tabular" label="Design File" help="Design file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
        <param name="uniqID" type="text" size="30" value="" label="Unique Feature ID" help="Name of the column in your Wide Dataset that has unique Feature IDs."/>
        <param name="group" type="text" size="30" label="Input Group name to separate by" help="Enter group name to calculate from. Spelling and capitalization must be exact"/>

        <param name="strategy" size="30" type="select" value="" label="Imputation Strategy" help="Recommended: KNN">
            <option value="KNN" selected="true">K-Nearest Neighbors</option>
            <option value="Bayesian" selected="true">Bayesian</option>
            <option value="mean" selected="true">mean</option>
            <option value="median" selected="true">median</option>
            <option value="most_frequent" selected="true">mode</option>

        </param>


        <param name="noZero" type="boolean" label="Count Zeroes as missing" help="Zeroes can be counted as missing or left as data"/>
        <param name="noNeg" type="boolean" label="Count Negative as missing" help="Negatives can be counted as missing or left as data"/>
        <param name="exclude" type="text" size="30" value="" label="Additional values to treat missing [Optional]" help="Seperate additional values to count as missing data with commas"/>

        <param name="k" type="text" size="30" value="5" label="K value" help="If you are not using the KNN Strategy, then ignore this. K is the number of neighbors to search. Default: 5"/>
        <param name="rowCutoff" type="text" size="30" value=".5" label="Row Percent Cutoff Value" help="If you are not using the KNN Strategy, then ignore this. If this is exceeded, imputation will be done by mean instead of knn. Default: .5 (50%)"/>
        <param name="colCutoff" type="text" size="30" value=".8" label="Column Percent Cutoff Value" help="If you are not using the KNN Strategy, then ignore this. If this is exceeded, imputation will be done by mean instead of knn. Default: .8 (80%)"/>
        <param name="bayesCutoff" type="text" size="30" value=".5" label="Bayesian Cutoff Value" help="If you are not using the Bayesian Strategy, then ignore this. For a given row, if this ratio of missing to present values is exceeded, imputation will be skipped. Must be greater than 0 and less than 1"/>
        <param name="muMethod" size="30" type="select" value="" label="Bayesian Mu Method" help="Recommended: Mean">
            <option value="mean" selected="true">mean</option>
            <option value="median" selected="true">median</option>
        </param>
        <param name="distribution" size="30" type="select" value="" label="Bayesian Distribution" help="Recommended: Mean">
            <option value="mean" selected="true">mean</option>
            <option value="median" selected="true">median</option>
        </param>
    </inputs>
    <outputs>
        <data format="tabular" name="imputed" label="${tool.name} on ${on_string}"/>
    </outputs>
    <macros>
        <import>macros.xml</import>
    </macros>
<help>

@TIP_AND_WARNING@

.. class:: infomark

**What it does**

This tool imputes missing data in a dataset.

--------------------------------------------------------------------------------

.. class:: warningmark

**Note**

- This tool currently treats all variables as continuous numeric
  variables. Running the tool on categorical variables might result in
  incorrect results. 
- Rows containing non-numeric (or missing) data in any
  of the chosen columns will be skipped from the analysis.

--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

    @WIDE@

    **NOTE:** The sample IDs must match the sample IDs in the Design File (below).
    Extra columns will automatically be ignored.


    @METADATA@

**In addition to your datasets, you need to provide:**

**Unique Feature ID**

- The column name in your wide dataset that contains the unique IDs for
  your features. In our example dataset you would input *Feature*.

--------------------------------------------------------------------------------

**Output Files**

- A wide format TSV with missing values filled in.


</help>
</tool>
