<tool id="dropFlag2" name="Drop Flags (Beta)" version="2.0.0">
    <description>Drop flagged values from data</description>
    <requirements>
        <requirement type="python-module">numpy</requirement>
        <requirement type="python-module">pandas</requirement>
    </requirements>
    <command interpreter="python">dropFlag.py
        --input $input
        --design $design
        --ID $uniqID
        --flags $flags
        --outWide $outWide
        --outFlags $outFlags
        --flagDrop $flagToDrop
        --value $reference

        #if $group
        --group $group
        #end if

        #if str( $conditional ) == '0'
        --condition '0'
        #end if
        #if str( $conditional ) == '1'
        --condition '1'
        #end if
        #if str( $conditional ) == '2'
        --condition '2'
        #end if

    </command>
    <inputs>
        <param name="input" type="data" format="tabular" label="Wide Dataset"
               help="Input dataset in wide format and tab separated. If file is not tab separated see TIP below."/>
        <param name="design" type="data" format="tabular" label="Design File"
               help="Design file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
        <param name="flags" type="data" format="tabular" label="Flag File"
               help="Input flagged dataset containing the flag value for each feature"/>
        <param name="uniqID" type="text" size="30" value="" label="Unique Feature ID"
               help="Name of the column in your Wide Dataset that has unique Feature IDs."/>
        <param name="flagToDrop" type="text" size="30" value="" label="Flag to Drop" 
               help="Name of the column/row in your Flag File to drop."/>
        <param name="conditional" size="30" type="select" value="" label="Condition of drop" help="Select type of conditional to compare in flags.">
            <option value="0" selected="true">Equals to</option>
            <option value="1" selected="true">Greater than</option>
            <option value="2" selected="true">Less than</option>
        </param>
        <param name="group" type="text" size="30" value="" optional="true" label="Group/Treatment [Optional]"
               help="Name of the column in your Design File that contains group classifications."/>
        <param name="reference" type="float" size="30"  value="1" label="Cutoff Value"
               help="Reference value to make comparison. Any rows/columns with a flag value equals,greater or less than this number will be dropped."/>
    </inputs>
    <outputs>
        <data format="tabular" name="outWide" label="Dropped wide"/>
        <data format="tabular" name="outFlags" label="Dropped flags"/>
    </outputs>
    <macros>
        <import>macros.xml</import>
    </macros>
<help>

@TIP_AND_WARNING@

**What it does**

This tool takes a Wide formatted dataset, a Design dataset and a file
containing 0/1 indicator flags and drops values based on a user selected
cutoff value. For feature 0/1 indicator flags, features are dropped from the Wide
dataset if the sum of all 0/1 indicator flags for a given feature is greater
than the cutoff value input by the user. For sample 0/1 indicator flags, samples
are dropped from the Wide dataset if the sum of all 0/1 indicator flags for a
given sample is greater than the cutoff value input by the user. Note that
features and samples are dropped in separate operations.

--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

    @WIDE@

    **NOTE:** The sample IDs must match the sample IDs in the Design File
    (below). Extra columns will automatically be ignored.


    @METADATA@

    **In addition to your datasets, you need to provide:**

    **Unique Feature ID**

    - The column name in your wide dataset that contains the unique IDs for
      your features. In our example dataset you would input *Feature*

      @GROUP_OPTIONAL@

    **Flag 0/1 Indicator File:** A flag indicator file corresponding to flagged
    (0/1) values for features (shown below) or samples::

        +----------+---------+---------+---------+-----+
        | Feature  | flag_A | flag_B   | flag_C  | ... |
        +==========+=========+=========+=========+=====+
        | one      | 0       | 0       | 0       | ... |
        | two      | 0       | 1       | 1       | ... |
        | three    | 0       | 1       | 0       | ... |
        | four     | 1       | 0       | 0       | ... |
        | ...      | ...     | ...     | ...     | ... |
        +----------+---------+---------+---------+-----+


    **Cutoff Value**

    If the sum of all the flags for a feature or sample is greater than this
    value, then that feature or sample will be dropped from the wide dataset.

    **Drop rows or columns**

    Select either rows or columns for dropping

--------------------------------------------------------------------------------

**Output Files**

- If dropping features:

    **modified_wide** file will be created that contains only the features where
    the sum of all indicator flags for the feature is less than the user given
    cutoff value.

- If dropping samples:

    **modified_wide** file will be created that contains only the features where
    the sum of all indicator flags for the feature is less than the user given
    cutoff value.

    **modified_design** file will be created that contains only the samples where
    the sum of all the indicator flags for the sample is less than the user given
    cutoff value.


</help>
</tool>
