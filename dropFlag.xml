<tool id="dropFlag" name="Drop Flags">
    <description>Drop flagged values from data</description>
    <requirements>
        <requirement type="python-module">numpy</requirement>
        <requirement type="python-module">pandas</requirement>
    </requirements>
    <command interpreter="python">dropFlag.py
        --input $input
        --design $design
        --ID $uniqID
        --wideOut $wideOut
        --flags $flags
        --cutoff $cutoff

        #if $group
        --group $group
        #end if

        #if str( $drop ) == 'row'
        --row
        #end if
        #if str( $drop ) == 'column'
        --column --designOut $designOut
        #end if
    </command>
    <inputs>
        <param name="input" type="data" format="tabular" label="Wide Dataset"
               help="Input dataset in wide format and tab separated. If not tab separated see TIP below."/>
        <param name="design" type="data" format="tabular" label="Metadata File"
               help="Metadata file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
        <param name="uniqID" type="text" size="30" value="" label="Unique Compound ID"
               help="Name of the column in your Wide Dataset that has unique compound/gene IDs."/>
        <param name="group" type="text" size="30" value="" optional="true" label="Group/Treatment [Optional]"
               help="Name of the column in your Metadata File that contains group classifications."/>
        <param name="flags" type="data" format="tabular" label="Flag File"
               help="Input flagged dataset containing the flag value for each compound"/>
        <param name="cutoff" type="float" size="30"  value=".5" label="Cutoff Value"
               help="All flag sums greater than this value will be deleted"/>
        <param name="drop" type="select" size="30" display="radio" value="" label="Drop rows or columns"
               help="Choose whether to drop rows or columns">
            <option value="row" selected="true">Drop the row value</option>
            <option value="column">Drop the column value</option>
        </param>
    </inputs>
    <outputs>
        <data format="tabular" name="wideOut" label="DroppedWide"/>
        <data format="tabular" name="designOut" label="DroppedMetadata">
            <filter>drop=='column'</filter>
        </data>
    </outputs>
<help>

.. class:: infomark

**TIP:** If your data is not TAB delimited, use *Text Manipulation-&gt;Convert*

.. class:: warningmark

**WARNINGS:**

    - (1) A row will be dropped when a pairwise comparison has a missing value.
    - (2) This script automatically removes spaces and special characters from strings.
    - (3) If a compound name starts with a number it will prepend an '_'.

--------------------------------------------------------------------------------

**What it does**

This tool takes a Wide formatted dataset, a Metadata dataset and a file
containing 0|1 indicator flags and drops values based on a user selected
cutoff. For feature 0|1 indicator flags, features are dropped from the Wide
dataset if the sum of all 0|1 indicator flags for a given feature is greater
than a cutoff value input by the user. For sample 0|1 indicator flags, samples
are dropped form the Wide dataset if the sum of all 0/1 indicator flags for a
given sample is greater than a cutoff value input by the user. Note that
features and samples are dropped in separate operations.

--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

    **Wide Formatted Dataset:** A wide formatted dataset that contains
    measurements for each sample.::

        +----------+---------+---------+---------+-----+
        | Compound | sample1 | sample2 | sample3 | ... |
        +==========+=========+=========+=========+=====+
        | one      | 10      | 20      | 10      | ... |
        | two      | 5       | 22      | 30      | ... |
        | three    | 30      | 27      | 2       | ... |
        | four     | 32      | 17      | 8       | ... |
        | ...      | ...     | ...     | ...     | ... |
        +----------+---------+---------+---------+-----+

    **NOTE:** The sample IDs must match the sample IDs in the Metadata File
    (below). Extra columns will automatically be ignored.


    **Metadata File:** A Metadata file relating samples to various
    groups/treatment.::

        +----------+--------+
        | sampleID | group1 |
        +==========+========+
        | sample1  | g1     |
        | sample2  | g1     |
        | sample3  | g1     |
        | sample4  | g2     |
        | sample5  | g2     |
        | sample6  | g2     |
        | ...      | ...    |
        +----------+--------+

    **NOTE: You must have a column named *sampleID*** and the values in this
    column must match the column names in the wide formatted dataset. Extra
    columns will be ignored.

    **In addition to your datasets, you need to provide:**

    **Unique Compound ID**

    - The column name in your wide dataset that contains the unique IDs for
      your compounds. In our example dataset you would input *Compound*

    **Group/Treatment** [Optional]

    - The column name in your metadata file that contains group information. In
      our example metadata file we would put *group1*. If provided samples will
      be colored by group.

    **Flag 0|1 Indicator File:** A flag indicator file corresponding to flagged
    (0|1) values for features (shown below) or samples::

        +----------+---------+---------+---------+-----+
        | Compound | flag_A | flag_B   | flag_C  | ... |
        +==========+=========+=========+=========+=====+
        | one      | 0       | 0       | 0       | ... |
        | two      | 0       | 1       | 1       | ... |
        | three    | 0       | 1       | 0       | ... |
        | four     | 1       | 0       | 0       | ... |
        | ...      | ...     | ...     | ...     | ... |
        +----------+---------+---------+---------+-----+


    **Cutoff Value**

    If the sum of all the flags for a feature or sample is greater than this
    value, then that feature or sample will be dropped from the wide dataset.

    **Drop rows or columns**

    Select either rows or columns for dropping

--------------------------------------------------------------------------------

**Output Files**

- If dropping features:

    **modified_wide** file will be created that contains only the features where
    the sum of all indicator flags for the feature is less than the user given
    cutoff value.

- If dropping samples:

    **modified_wide** file will be created that contains only the features where
    the sum of all indicator flags for the feature is less than the user given
    cutoff value.

    **modified_metadata** file will be created that contains only the samples where
    the sum of all the indicator flags for the sample is less than the user given
    cutoff value.


</help>
</tool>
